<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baloro Nero Studio</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        body { margin: 0; font-family: 'Arial', sans-serif; background-color: #000; color: white; }
        
        /* The 3D Viewer Window */
        model-viewer {
            width: 100%;
            height: 60vh;
            background-color: #1a1a1a;
        }

        /* The Control Panel */
        .controls {
            padding: 20px;
            text-align: center;
            background: linear-gradient(to top, #000 80%, transparent);
        }

        h2 { color: #d4af37; text-transform: uppercase; letter-spacing: 2px; margin-top: 0; }
        
        /* Buttons */
        .btn-group button {
            background: #333; color: white; border: 1px solid #555;
            padding: 10px 15px; border-radius: 5px; margin: 5px; cursor: pointer;
        }
        .btn-group button:hover { background: #d4af37; color: black; }

        /* The Input Form */
        input {
            width: 80%; padding: 12px; margin: 10px 0;
            border-radius: 5px; border: none; background: #222; color: white;
        }
        
        .submit-btn {
            background-color: #d4af37; color: black; font-weight: bold;
            width: 90%; padding: 15px; font-size: 16px; border: none;
            border-radius: 5px; cursor: pointer; margin-top: 10px;
        }
    </style>
</head>
<body>

    <model-viewer 
        id="carViewer"
        src="./car.glb" 
        ar 
        ar-modes="webxr scene-viewer quick-look" 
        camera-controls 
        tone-mapping="aces"
        shadow-intensity="1"
        environment-image="./lighting.hdr">
        
        <div slot="progress-bar"></div>
    </model-viewer>

    <div class="controls">
        <h2>Baloro Nero Studio</h2>
        <p>Customize your dream spec.</p>

        <div class="btn-group">
            <button onclick="setEnv('studio')">Studio Light</button>
            <button onclick="setEnv('neon')">Neon Night</button>
        </div>

        <form name="submit-to-google-sheet">
            <input type="text" name="Name" placeholder="Your Name" required>
            <input type="email" name="Email" placeholder="Your Email" required>
            
            <input type="hidden" name="Car Choice" id="carChoice" value="Standard Spec">
            
            <button type="submit" class="submit-btn">SUBMIT & WIN SPRAY GUN</button>
        </form>
    </div>

    <script>
        // 1. Handle Background Changes
        const viewer = document.querySelector("#carViewer");
        
        function setEnv(type) {
            if(type === 'studio') {
                viewer.environmentImage = './lighting.hdr'; 
                document.getElementById('carChoice').value = "Studio Spec";
            } else {
                // Using a free default HDR from Google for neon effect
                viewer.environmentImage = 'https://modelviewer.dev/shared-assets/environments/moon_1k.hdr';
                document.getElementById('carChoice').value = "Neon Spec";
            }
        }

        // 2. The "Baloro Nero" Paint Logic (Force Black)
        viewer.addEventListener("load", () => {
            const material = viewer.model.materials[0]; // Grabs the main car paint
            if(material) {
                material.pbrMetallicRoughness.setBaseColorFactor([0, 0, 0, 1]); // Black
                material.pbrMetallicRoughness.setMetallicFactor(0.9); // Very Metallic
                material.pbrMetallicRoughness.setRoughnessFactor(0.2); // Very Shiny
            }
        });

        // 3. Send Data to Google Sheets
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwxN4ST0jK39xFGp8rc1i_vDD4D4fMl6Y9Bxn2TsN98JZTaeV9YCzRwFTefTOoH14y5/exec'; // <--- PASTE YOUR URL HERE
        const form = document.forms['submit-to-google-sheet'];

        form.addEventListener('submit', e => {
            e.preventDefault();
            fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(response => alert("Entry Submitted! Good Luck!"))
            .catch(error => console.error('Error!', error.message));
        });
    </script>

</body>
</html>